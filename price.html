<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPS Store Tag Tool</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bwip-js/3.0.4/bwip-js-min.js"></script>

    <style>
        /* --- CSS STYLING --- */
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; padding: 0; background: #e9ecef; height: 100vh; display: flex; overflow: hidden; 
            position: relative;
        }

        .home-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: #007bff;
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
            font-size: 13px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 1001; 
            transition: background 0.2s;
        }

        .home-button:hover {
            background-color: #0056b3;
        }

        .main-content { display: flex; flex: 1; width: 100%; height: 100%; }
        
        .controls-panel { 
            width: 380px; padding: 20px; background: white; border-right: 1px solid #ccc; 
            box-shadow: 2px 0 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; z-index: 10; overflow-y: auto; 
        }

        .preview-panel { 
            flex: 1; background: #525659; padding: 20px; display: flex; justify-content: center; align-items: flex-start; overflow-y: auto; 
        }

        iframe { 
            width: 400px; height: 600px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.3); background: white; 
        }

        .mode-switch {
            display: flex; background: #f1f3f5; padding: 4px; border-radius: 8px; 
            margin-bottom: 20px; 
            margin-top: 45px; 
        }

        .mode-switch label {
            flex: 1; text-align: center; padding: 8px; cursor: pointer; border-radius: 6px; font-size: 14px; font-weight: 600; color: #555; transition: 0.2s;
        }

        .mode-switch input { display: none; }
        .mode-switch input:checked + label { background: white; color: #007bff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .input-group { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
        .shelf-group { border: 1px solid #eee; padding: 10px; border-radius: 8px; background: #fafafa; }
        .shelf-header { font-size: 12px; font-weight: bold; color: #007bff; margin-bottom: 8px; }
        .field { display: flex; flex-direction: column; gap: 4px; }
        label.field-label { font-weight: 700; font-size: 0.75em; color: #555; text-transform: uppercase; letter-spacing: 0.5px; }
        input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; transition: border 0.2s; }
        input:focus { outline: none; border-color: #007bff; }
        .btn-col { display: flex; flex-direction: column; gap: 10px; margin-top: auto; padding-top: 20px; }
        button { padding: 14px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; font-size: 15px; }
        .btn-dl { background: #28a745; color: white; } .btn-dl:hover { background: #218838; }
        .btn-clear { background: white; color: #dc3545; border: 2px solid #f8f9fa; } .btn-clear:hover { background: #fff5f5; border-color: #dc3545; }
        #genCanvas { display: none; }
        .hidden { display: none !important; }

        @media print {
            .home-button, .controls-panel { display: none; }
        }
    </style>
</head>
<body>

<a href="https://ups4066.com/" class="home-button">Home</a>

<div class="main-content">
    <div class="controls-panel">
        <div class="mode-switch">
            <input type="radio" name="mode" id="modeStandard" value="standard" checked onchange="toggleMode()">
            <label for="modeStandard">Standard (15x)</label>
            <input type="radio" name="mode" id="modeShelf" value="shelf" onchange="toggleMode()">
            <label for="modeShelf">Shelf Tags (4x)</label>
        </div>
        
        <div id="standardInputs" class="input-group">
            <div class="field"><label class="field-label">Item Name</label><input type="text" id="stdName" placeholder="e.g. Bubble Wrap" autocomplete="off" oninput="triggerPreview()" /></div>
            <div class="field"><label class="field-label">Price ($)</label><input type="text" id="stdPrice" placeholder="e.g. 1,000.00" maxlength="10" autocomplete="off" oninput="handlePriceInput(this)" onblur="formatPriceInput(this)" /></div>
            <div class="field"><label class="field-label">SKU (8 Digits)</label><input type="text" id="stdSku" placeholder="e.g. 10020030" maxlength="8" autocomplete="off" oninput="handleSkuInput(this)" /></div>
        </div>

        <div id="shelfInputs" class="input-group hidden">
            <div class="shelf-group"><div class="shelf-header">Tag #1</div><div class="field"><input type="text" id="shelfName1" placeholder="Item Name" autocomplete="off" oninput="triggerPreview()"></div><div style="display:flex; gap:10px; margin-top:5px;"><input type="text" id="shelfPrice1" placeholder="Price" maxlength="10" autocomplete="off" oninput="handlePriceInput(this)" onblur="formatPriceInput(this)"><input type="text" id="shelfSku1" placeholder="SKU" maxlength="8" autocomplete="off" oninput="handleSkuInput(this)"></div></div>
            <div class="shelf-group"><div class="shelf-header">Tag #2</div><div class="field"><input type="text" id="shelfName2" placeholder="Item Name" autocomplete="off" oninput="triggerPreview()"></div><div style="display:flex; gap:10px; margin-top:5px;"><input type="text" id="shelfPrice2" placeholder="Price" maxlength="10" autocomplete="off" oninput="handlePriceInput(this)" onblur="formatPriceInput(this)"><input type="text" id="shelfSku2" placeholder="SKU" maxlength="8" autocomplete="off" oninput="handleSkuInput(this)"></div></div>
            <div class="shelf-group"><div class="shelf-header">Tag #3</div><div class="field"><input type="text" id="shelfName3" placeholder="Item Name" autocomplete="off" oninput="triggerPreview()"></div><div style="display:flex; gap:10px; margin-top:5px;"><input type="text" id="shelfPrice3" placeholder="Price" maxlength="10" autocomplete="off" oninput="handlePriceInput(this)" onblur="formatPriceInput(this)"><input type="text" id="shelfSku3" placeholder="SKU" maxlength="8" autocomplete="off" oninput="handleSkuInput(this)"></div></div>
            <div class="shelf-group"><div class="shelf-header">Tag #4</div><div class="field"><input type="text" id="shelfName4" placeholder="Item Name" autocomplete="off" oninput="triggerPreview()"></div><div style="display:flex; gap:10px; margin-top:5px;"><input type="text" id="shelfPrice4" placeholder="Price" maxlength="10" autocomplete="off" oninput="handlePriceInput(this)" onblur="formatPriceInput(this)"><input type="text" id="shelfSku4" placeholder="SKU" maxlength="8" autocomplete="off" oninput="handleSkuInput(this)"></div></div>
        </div>

        <div class="btn-col">
            <button class="btn-dl" onclick="downloadPDF()">ðŸ“¥ Download PDF</button>
            <button class="btn-clear" onclick="clearFields()">âœ¨ Clear Fields</button>
        </div>

        <div style="margin-top: 20px; font-size: 11px; color: #999; text-align: center;">Made by Gradin Dodson</div>
    </div>
    <div class="preview-panel">
        <iframe id="pdfPreview" title="PDF Preview"></iframe>
    </div>
</div>
<canvas id="genCanvas"></canvas>

<script>
    const canvas = document.getElementById('genCanvas');
    let debounceTimer;
    let currentMode = 'standard';

    function toggleMode() {
        if (document.getElementById('modeStandard').checked) {
            currentMode = 'standard';
            document.getElementById('standardInputs').classList.remove('hidden');
            document.getElementById('shelfInputs').classList.add('hidden');
        } else {
            currentMode = 'shelf';
            document.getElementById('standardInputs').classList.add('hidden');
            document.getElementById('shelfInputs').classList.remove('hidden');
        }
        triggerPreview();
    }

    function handleSkuInput(input) {
        let val = input.value.replace(/[^0-9]/g, '');
        if (val.length > 8) val = val.substring(0, 8);
        input.value = val;
        triggerPreview();
    }

    function handlePriceInput(input) {
        let raw = input.value.replace(/[^0-9.]/g, '');
        const parts = raw.split('.');
        if (parts.length > 2) raw = parts[0] + '.' + parts.slice(1).join('');
        if (parts[0].length > 5) { parts[0] = parts[0].substring(0, 5); raw = parts.length > 1 ? parts[0] + "." + parts[1] : parts[0]; }
        if (parts.length > 1 && parts[1].length > 2) { parts[1] = parts[1].substring(0, 2); raw = parts[0] + "." + parts[1]; }
        input.value = raw;
        triggerPreview();
    }

    function formatPriceInput(input) {
        if (!input.value) return;
        const cleanVal = input.value.replace(/,/g, '');
        const num = parseFloat(cleanVal);
        if (!isNaN(num)) { input.value = num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); triggerPreview(); }
    }

    function triggerPreview() { clearTimeout(debounceTimer); debounceTimer = setTimeout(updatePreview, 300); }

    function generateBarcodeData(sku) {
        if (!sku) return null;
        try {
            bwipjs.toCanvas(canvas, { bcid: 'datamatrix', text: sku, scale: 2, height: 10, includetext: false, padding: 0 });
            return canvas.toDataURL('image/png');
        } catch (e) { return null; }
    }

    function clearFields() {
        document.getElementById('stdName').value = ''; document.getElementById('stdPrice').value = ''; document.getElementById('stdSku').value = '';
        for(let i=1; i<=4; i++) { document.getElementById(`shelfName${i}`).value = ''; document.getElementById(`shelfPrice${i}`).value = ''; document.getElementById(`shelfSku${i}`).value = ''; }
        document.getElementById('pdfPreview').src = "about:blank";
    }

    function createFullSheetPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ orientation: "p", unit: "in", format: [4, 6] });
        const MARGIN_TOP = 0.05; const MARGIN_BOTTOM = 0.75; const MARGIN_SIDE = 0.04;
        const printableWidth = 4 - (MARGIN_SIDE * 2);
        const printableHeight = 6 - (MARGIN_TOP + MARGIN_BOTTOM);

        if (currentMode === 'standard') {
            const name = document.getElementById('stdName').value.trim();
            const rawPrice = document.getElementById('stdPrice').value.trim();
            const sku = document.getElementById('stdSku').value.trim();
            if (!name && !rawPrice && !sku) return null;

            let displayPrice = rawPrice;
            const cleanVal = rawPrice.replace(/,/g, '');
            if (!isNaN(parseFloat(cleanVal)) && rawPrice) { displayPrice = parseFloat(cleanVal).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }
            const imgData = generateBarcodeData(sku);
            const cols = 3; const rows = 5;
            const tagWidth = printableWidth / cols; const tagHeight = printableHeight / rows;
            let col = 0, row = 0;

            for (let i = 0; i < 15; i++) {
                const x = MARGIN_SIDE + (col * tagWidth); const y = MARGIN_TOP + (row * tagHeight); const centerX = x + (tagWidth/2);
                doc.setLineWidth(0.01); doc.setDrawColor(0); doc.rect(x, y, tagWidth, tagHeight);
                let displayName = name.length > 18 ? name.substring(0,17) + ".." : name;
                doc.setFontSize(9); doc.setFont("helvetica", "bold"); doc.text(displayName, centerX, y + 0.16, { align: "center" });
                if (imgData) doc.addImage(imgData, 'PNG', centerX - 0.225, y + 0.22, 0.45, 0.40);
                doc.setFontSize(7); doc.setFont("helvetica", "normal"); doc.text(sku, centerX, y + 0.70, { align: "center" });
                if (displayPrice) { doc.setFontSize(14); doc.setFont("helvetica", "bold"); doc.text(`$${displayPrice}`, centerX, y + tagHeight - 0.10, { align: "center" }); }
                col++; if (col >= cols) { col = 0; row++; }
            }
        } else {
            const cols = 1; const rows = 4;
            const tagWidth = printableWidth / cols; const tagHeight = printableHeight / rows;
            let hasData = false;

            for (let i = 1; i <= 4; i++) {
                const name = document.getElementById(`shelfName${i}`).value.trim();
                const rawPrice = document.getElementById(`shelfPrice${i}`).value.trim();
                const sku = document.getElementById(`shelfSku${i}`).value.trim();
                if (name || rawPrice || sku) hasData = true;

                let displayPrice = rawPrice;
                const cleanVal = rawPrice.replace(/,/g, '');
                if (!isNaN(parseFloat(cleanVal)) && rawPrice) { displayPrice = parseFloat(cleanVal).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }
                const imgData = generateBarcodeData(sku);
                const rowIdx = i - 1;
                const x = MARGIN_SIDE; const y = MARGIN_TOP + (rowIdx * tagHeight);

                doc.setLineWidth(0.02); doc.setDrawColor(0); doc.rect(x, y, tagWidth, tagHeight);

                const paddingX = 0.15; const barcodeSize = 0.75; 
                const barcodeX = x + paddingX;
                const barcodeY = y + (tagHeight/2) - (barcodeSize/2) - 0.08;
                if (imgData) doc.addImage(imgData, 'PNG', barcodeX, barcodeY, barcodeSize, barcodeSize);

                doc.setFontSize(9); doc.setFont("helvetica", "bold");
                doc.text(sku, barcodeX + (barcodeSize/2), barcodeY + barcodeSize + 0.12, { align: "center" });

                const textX = barcodeX + barcodeSize + 0.25;
                
                doc.setFontSize(14); doc.setFont("helvetica", "bold");
                const maxTextWidth = (x + tagWidth) - textX - 0.1;
                let splitTitle = doc.splitTextToSize(name.toUpperCase(), maxTextWidth);
                if (splitTitle.length > 2) {
                     splitTitle = splitTitle.slice(0, 2);
                     splitTitle[1] += ".."; 
                }
                doc.text(splitTitle, textX, y + 0.45, { align: "left" });

                if (displayPrice) {
                    doc.setFontSize(28); doc.setFont("helvetica", "bold");
                    doc.text(`$${displayPrice}`, textX, y + tagHeight - 0.25, { align: "left" });
                }
            }
            if (!hasData) return null;
        }
        return doc;
    }

    function updatePreview() {
        const doc = createFullSheetPDF();
        if (doc) { document.getElementById('pdfPreview').src = doc.output('bloburl'); } else { document.getElementById('pdfPreview').src = "about:blank"; }
    }

    function downloadPDF() {
        const doc = createFullSheetPDF();
        if (doc) {
            let filename = "Tags.pdf";
            if (currentMode === 'standard') {
                const sku = document.getElementById('stdSku').value.trim();
                const rawPrice = document.getElementById('stdPrice').value.trim();
                let priceStr = "";
                const cleanVal = rawPrice.replace(/,/g, '');
                const numPrice = parseFloat(cleanVal);
                if (!isNaN(numPrice)) { 
                    let tempStr = numPrice.toFixed(2);
                    priceStr = tempStr.replace('.', '-');
                }
                if (sku && priceStr) { filename = `${priceStr}_${sku}.pdf`; }
            } else { filename = "Shelf_Tags.pdf"; }
            doc.save(filename);
        } else { alert("Please enter item details first."); }
    }
</script>
</body>
</html>
